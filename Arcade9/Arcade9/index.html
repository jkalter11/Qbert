<!doctype html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Q*bert!</title>
    <script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>
</head>
<body>

    <script type="text/javascript">

        window.onload = function () {

            //  Note that this html file is set to pull down Phaser 2.5.0 from the JS Delivr CDN.
            //  Although it will work fine with this tutorial, it's almost certainly not the most current version.
            //  Be sure to replace it with an updated version before you start experimenting with adding your own code.

            var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
            var player;
            var platforms;
            var cursors;
            var jumpButton;
            var playerOriginalX;
            var playerOriginalY;
            var cube;
            var letdown = false;
            var downcount;
            var timer;


            function preload() {

                //add in  spritesheets
                game.stage.backgroundColor = '#000000';
                game.load.spritesheet('platform', 'Blocks.png', 32, 32, 4);
                game.load.spritesheet('player', 'QBert.png', 16, 16, 8);

            }


            function create() {
                game.physics.startSystem(Phaser.Physics.ARCADE);

                //sets pyramid and the cubes collision
                platforms = game.add.physicsGroup();
                pyramid();
                platforms.setAll('body.immovable', true);




                //add player sprite, animation, and physics
                player = game.add.sprite(400, 110, 'player');
                player.animations.add('left', [2, 3], 2, false);
                player.animations.add('right', [4, 5], 2, false);
                player.animations.add('up', [0, 1], 2, false);
                player.animations.add('down', [6, 7], 2, false);
                game.physics.arcade.enable(player);

                //set player gravity and stops him from leaving the screen's boundry
                player.body.collideWorldBounds = true;
                player.body.gravity.y = 500;

                player.body.checkCollision.up = false;
                player.body.checkCollision.left = false;
                player.body.checkCollision.right = false;


                cursors = game.input.keyboard.createCursorKeys();
                jumpButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

            }

            function update()
            {

                game.physics.arcade.collide(player, platforms, cubeColor);

                if (letdown == true && downcount == 50) {
                    //if(downcount >= 5)
                    {
                        player.body.checkCollision.down = true;
                        letdown = false;
                        downcount = 0;
                    }
                    //else
                    //    downcount += 1;
                }
                downcount++;

                if (player.body.touching.down) {
                    player.body.velocity.x = 0;
                }
                if (cursors.up.isDown && (player.body.touching.down)) {
                    player.body.velocity.y = -200;
                    player.body.velocity.x = 15;
                }
                if (cursors.down.isDown && (player.body.touching.down)) {
                    player.body.velocity.y = -200;
                    player.body.velocity.x = -15;
                    player.body.checkCollision.down = false;
                    letdown = true;
                    downcount = 0;
                    //timer.loop(1000, updateCounter, this);
                }
                if (cursors.left.isDown && (player.body.touching.down)) {
                    player.body.velocity.y = -200;
                    player.body.velocity.x = -15;
                }
                if (cursors.right.isDown && (player.body.touching.down)) {
                    player.body.checkCollision.down = false;
                    letdown = true;
                    player.body.velocity.y = -200;
                    player.body.velocity.x = 15;
                    downcount = 0;
                    //timer.loop(1000, updateCounter, this);

                }

                if (player.body.onFloor())
                {
                    player.x = 405;
                    player.y = 110;
                }

            }


            function cubeColor(player, star) {
               // cube.kill();

            }

            //  Here we'll create 7 columns of cubes evenly spaced apart
            // this code needs to be revised, but it's fine for the presentation. I'll improve it once other features are in.
            function pyramid()
            {

                for (var i = 0; i < 7; i++) {
                    //  Create a star inside of the 'stars' group
                    var cube = platforms.create((i * 15) + 400, (i * 25) + 200, 'platform');

                }

                for (var i = 0; i < 6; i++) {
                    //  Create a star inside of the 'stars' group
                    var cube = platforms.create((i * 15) + 385, (i * 25) + 225, 'platform');

                }

                for (var i = 0; i < 5; i++) {
                    //  Create a star inside of the 'stars' group
                    var cube = platforms.create((i * 15) + 370, (i * 25) + 250, 'platform');

                }

                for (var i = 0; i < 4; i++) {
                    //  Create a star inside of the 'stars' group
                    var cube = platforms.create((i * 15) + 355, (i * 25) + 275, 'platform');

                }

                for (var i = 0; i < 3; i++) {
                    //  Create a star inside of the 'stars' group
                    var cube = platforms.create((i * 15) + 340, (i * 25) + 300, 'platform');

                }

                for (var i = 0; i < 2; i++) {
                    //  Create a star inside of the 'stars' group
                    var cube = platforms.create((i * 15) + 325, (i * 25) + 325, 'platform');

                }

                for (var i = 0; i < 1; i++) {
                    //  Create a star inside of the 'stars' group
                    var cube = platforms.create((i * 15) + 310, (i * 25) + 350, 'platform');

                }

            }



        };

    </script>

</body>
</html>